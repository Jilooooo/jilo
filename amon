    <div class="balloon b5"></div>

    <div class="topbar">
      <div class="badge">For Sophia</div>
      <div class="subtitle">November 9, 2025</div>
    </div>

    <div class="card">
      <div class="left">
        <div class="greeting">Happy Birthday!</div>
        <div class="who">Sophia Simoune Buenaventura</div>
        <div class="date">November 9, 2025</div>
        <div class="message" id="message">Happy Birthday, Sophia! May your special day be filled with joy, love, and surprises. Wishing you endless smiles, laughter, and dreams come true! ðŸŽ‚âœ¨</div>
      </div>

      <div class="right">
        <div class="circle">ðŸŽ‚</div>
        <div class="controls">
          <button class="play" id="playBtn">Play Song</button>
          <button class="surprise" id="surpriseBtn">Send Surprise</button>
          <button class="download" id="downloadBtn">Download as Picture</button>
        </div>
      </div>
    </div>

    <div class="credits">AMON</div>
  </div>

  <script>
    // Confetti animation
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize(){ canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; }
    window.addEventListener('resize', resize); resize();

    function rand(min,max){return Math.random()*(max-min)+min}
    function spawnConfetti(x,y,amount=160){
      for(let i=0;i<amount;i++){
        particles.push({x:x||rand(canvas.width*0.2,canvas.width*0.8),y:y||canvas.height*0.6,vx:rand(-9,9),vy:rand(-14,4),size:rand(6,14),color:`hsl(${~~rand(300,350)},80%,65%)`,rot:rand(0,6.28),rotSpeed:rand(-0.2,0.2),life:rand(80,220)});
      }
    }

    function update(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=particles.length-1;i>=0;i--){
        const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.25; p.rot+=p.rotSpeed; p.life--;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
        ctx.restore();
        if(p.y>canvas.height+80 || p.x<-80 || p.x>canvas.width+80 || p.life<=0) particles.splice(i,1);
      }
      requestAnimationFrame(update);
    }
    update();

    // WebAudio Happy Birthday melody
    let audioCtx = null;
    function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
    function playTone(freq, duration, startTime){
      const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
      o.type='sine'; o.frequency.value = freq; g.gain.value = 0.0001;
      o.connect(g); g.connect(audioCtx.destination);
      g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime + 0.02 + startTime);
      o.start(audioCtx.currentTime + startTime); o.stop(audioCtx.currentTime + startTime + duration);
    }

    const notes = { C4:261.63, D4:293.66, E4:329.63, F4:349.23, G4:392.00, A4:440.00, B4:493.88, C5:523.25, D5:587.33, E5:659.25, F5:698.46, G5:783.99 };
    const seq = [
      [notes.G4,0.35],[notes.G4,0.35],[notes.A4,0.7],[notes.G4,0.7],[notes.C5,0.7],[notes.B4,1.4],
      [notes.G4,0.35],[notes.G4,0.35],[notes.A4,0.7],[notes.G4,0.7],[notes.D5,0.7],[notes.C5,1.4],
      [notes.G4,0.35],[notes.G4,0.35],[notes.G5,0.7],[notes.E5,0.7],[notes.C5,0.7],[notes.B4,0.7],[notes.A4,0.7],
      [notes.F5,0.35],[notes.F5,0.35],[notes.E5,0.7],[notes.C5,0.7],[notes.D5,0.7],[notes.C5,1.4]
    ];

    function playSequence(){
      ensureAudio(); if(audioCtx.state === 'suspended') audioCtx.resume();
      let t = 0;
      for(const [f,d] of seq){ playTone(f,d,t); t += d; }
    }

    // Controls
    const playBtn = document.getElementById('playBtn');
    const surpriseBtn = document.getElementById('surpriseBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const stage = document.getElementById('stage');

    playBtn.addEventListener('click', ()=>{ playSequence(); });

    surpriseBtn.addEventListener('click', ()=>{
      spawnConfetti(undefined, undefined, 220);
      ensureAudio(); if(audioCtx.state === 'suspended') audioCtx.resume();
      playTone(notes.C5,0.14,0); playTone(notes.E5,0.14,0.16); playTone(notes.G5,0.2,0.32);
      setTimeout(()=>{ alert('You sent a surprise to Sophia! ðŸŽ‰'); },350);
    });

    // Download stage as PNG using html2canvas
    downloadBtn.addEventListener('click', ()=>{
      html2canvas(stage).then(canvas => {
        const link = document.createElement('a');
        link.download = 'HappyBirthday_Sophia.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    });
  </script>
</body>
</html>
